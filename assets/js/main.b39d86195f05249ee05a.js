(()=>{"use strict";(()=>{const t=24,e=(t,e)=>Math.floor(Math.random()*(e-t)+t);var s,i;!function(t){t.Background="#333",t.Border="#000",t.Line="#444",t.Snake="#0f0",t.Apple="#f00"}(s||(s={})),function(t){t.ArrowUp="ArrowUp",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight"}(i||(i={}));class o{constructor(t,e){this.coordinates=[{x:11,y:11}],this.ctx=t,this.step=e}get coords(){return this.coordinates}render(){this.ctx.fillStyle=s.Snake;for(const t of this.coordinates)this.ctx.fillRect(t.x*this.step,t.y*this.step,this.step,this.step)}move(e,s){const o=this.coordinates[this.coordinates.length-1],r=s.checkCollision(this.coordinates),h=r?this.coordinates:this.coordinates.slice(1);switch(r&&s.make(),e){case i.ArrowRight:this.coordinates=[...h,{x:o.x+1>=t?0:o.x+1,y:o.y}];break;case i.ArrowDown:this.coordinates=[...h,{x:o.x,y:o.y+1>=t?0:o.y+1}];break;case i.ArrowLeft:this.coordinates=[...h,{x:o.x?o.x-1:23,y:o.y}];break;case i.ArrowUp:default:this.coordinates=[...h,{x:o.x,y:o.y?o.y-1:23}]}}}class r{constructor(t,e,s){this.ctx=t,this.step=e,this.snake=s}checkCollision(t){var e;for(const s of t)if(s.x===(null===(e=this.coordinate)||void 0===e?void 0:e.x)&&s.y===this.coordinate.y)return!0;return!1}make(){let t;for(;!t;){const s={x:e(0,23),y:e(0,23)};for(const e of this.snake.coords)if(e.x!==s.x&&e.y!==s.y){t=s;break}}this.coordinate=t}render(){this.coordinate&&(this.ctx.fillStyle=s.Apple,this.ctx.fillRect(this.coordinate.x*this.step,this.coordinate.y*this.step,this.step,this.step))}}new class{constructor(){this.size=document.body.offsetWidth/3,this.step=this.size/t,this.score=document.getElementById("score"),this.scoreCount=void 0,this.direction=i.ArrowUp,this.speed=500;const e=document.createElement("canvas");e.width=this.size,e.height=this.size;const s=document.getElementById("root");s&&s.appendChild(e);const h=e.getContext("2d");this.startHandler=this.startHandler.bind(this),this.keyboardHandler=this.keyboardHandler.bind(this),h&&(this.ctx=h,this.snake=new o(this.ctx,this.step),this.apple=new r(this.ctx,this.step,this.snake),this.apple.make(),this.render(),document.addEventListener("keyup",this.startHandler))}checkKeyboardEvent(t){return[i.ArrowUp,i.ArrowRight,i.ArrowDown,i.ArrowLeft].includes(t.key)}setSnakeLength(){var t,e;this.score&&(this.scoreCount&&this.scoreCount!==(null===(t=this.snake)||void 0===t?void 0:t.coords.length)&&(this.speed=.95*this.speed),this.scoreCount=null===(e=this.snake)||void 0===e?void 0:e.coords.length,this.score.innerHTML=this.scoreCount?`Длина змеи ${this.scoreCount}`:"")}tick(){var t;this.apple&&(null===(t=this.snake)||void 0===t||t.move(this.direction,this.apple),this.setSnakeLength()),this.render(),setTimeout((()=>this.tick()),this.speed)}startHandler(t){this.checkKeyboardEvent(t)&&(this.keyboardHandler(t),document.removeEventListener("keyup",this.startHandler),document.addEventListener("keyup",this.keyboardHandler),this.tick())}keyboardHandler(t){this.checkKeyboardEvent(t)&&(t.preventDefault(),t.stopPropagation(),this.direction=t.key)}renderBoard(){if(this.ctx){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillStyle=s.Background,this.ctx.fillRect(0,0,this.size,this.size),this.ctx.beginPath(),this.ctx.strokeStyle=s.Line;for(let t=0;t<=this.size;t+=this.step)this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.size),this.ctx.moveTo(0,t),this.ctx.lineTo(this.size,t);this.ctx.stroke(),this.ctx.strokeStyle=s.Border,this.ctx.strokeRect(0,0,this.size-1,this.size-1)}}render(){var t,e;this.renderBoard(),null===(t=this.apple)||void 0===t||t.render(),null===(e=this.snake)||void 0===e||e.render()}}})()})();