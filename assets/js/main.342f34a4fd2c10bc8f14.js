(()=>{"use strict";(()=>{const t=24,e=(t,e)=>Math.floor(Math.random()*(e-t)+t);var s,i;!function(t){t.Background="#333",t.Border="#000",t.Line="#444",t.Snake="#0f0",t.Apple="#f00"}(s||(s={})),function(t){t.ArrowUp="ArrowUp",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.Space=" "}(i||(i={}));const r={[i.ArrowUp]:i.ArrowDown,[i.ArrowLeft]:i.ArrowRight,[i.ArrowRight]:i.ArrowLeft,[i.ArrowDown]:i.ArrowUp,[i.Space]:i.Space},o=[{x:11,y:11}];class n{constructor(t,e){this.ctx=t,this.step=e,this.coordinates=o}reset(){this.coordinates=o}get coords(){return this.coordinates}render(){this.ctx.fillStyle=s.Snake;for(const t of this.coordinates)this.ctx.fillRect(t.x*this.step,t.y*this.step,this.step,this.step)}move(e,s){const r=this.coordinates[this.coordinates.length-1],o=s.checkCollision(this.coordinates),n=o?this.coordinates:this.coordinates.slice(1);switch(o&&s.make(),e){case i.ArrowRight:this.coordinates=[...n,{x:r.x+1>=t?0:r.x+1,y:r.y}];break;case i.ArrowDown:this.coordinates=[...n,{x:r.x,y:r.y+1>=t?0:r.y+1}];break;case i.ArrowLeft:this.coordinates=[...n,{x:r.x?r.x-1:23,y:r.y}];break;case i.ArrowUp:default:this.coordinates=[...n,{x:r.x,y:r.y?r.y-1:23}]}}checkCollision(){const t=this.coordinates[this.coordinates.length-1];for(let e=0;e<this.coordinates.length-1;e++){const s=this.coordinates[e];if(t.x===s.x&&t.y===s.y)return!0}return!1}}class h{constructor(t,e,s){this.ctx=t,this.step=e,this.snake=s}checkCollision(t){var e;for(const s of t)if(s.x===(null===(e=this.coordinate)||void 0===e?void 0:e.x)&&s.y===this.coordinate.y)return!0;return!1}make(){let t;for(;!t;){const s={x:e(0,23),y:e(0,23)};for(const e of this.snake.coords)if(e.x!==s.x&&e.y!==s.y){t=s;break}}this.coordinate=t}render(){this.coordinate&&(this.ctx.fillStyle=s.Apple,this.ctx.fillRect(this.coordinate.x*this.step,this.coordinate.y*this.step,this.step,this.step))}}class c{constructor(t,e,s){this.ctx=t,this.size=e,this.step=s}render(){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillStyle=s.Background,this.ctx.fillRect(0,0,this.size,this.size),this.ctx.beginPath(),this.ctx.strokeStyle=s.Line;for(let t=0;t<=this.size;t+=this.step)this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.size),this.ctx.moveTo(0,t),this.ctx.lineTo(this.size,t);this.ctx.stroke(),this.ctx.strokeStyle=s.Border,this.ctx.strokeRect(0,0,this.size-1,this.size-1)}}new class{constructor(){this.size=document.body.offsetWidth/3,this.step=this.size/t,this.score=document.getElementById("score"),this.scoreCount=void 0,this.fail=document.getElementById("fail"),this.direction=i.ArrowUp,this.speed=500;const e=document.createElement("canvas");e.width=this.size,e.height=this.size;const s=document.getElementById("root");s&&s.appendChild(e);const r=e.getContext("2d");this.startHandler=this.startHandler.bind(this),this.keyboardHandler=this.keyboardHandler.bind(this),this.restart=this.restart.bind(this),r&&(this.ctx=r,this.snake=new n(this.ctx,this.step),this.apple=new h(this.ctx,this.step,this.snake),this.board=new c(this.ctx,this.size,this.step),this.apple.make(),this.render(),this.initHandlers())}checkKeyboardEvent(t){return[i.ArrowUp,i.ArrowRight,i.ArrowDown,i.ArrowLeft].includes(t.key)}setSnakeLength(){var t,e;this.score&&this.scoreCount&&this.scoreCount!==(null===(t=this.snake)||void 0===t?void 0:t.coords.length)&&(this.speed=.95*this.speed,this.snake&&(this.scoreCount=null===(e=this.snake)||void 0===e?void 0:e.coords.length,this.score.innerHTML=this.scoreCount?`Длина змеи ${this.scoreCount}`:""))}tick(){var t,e;if(this.apple){if(null===(t=this.snake)||void 0===t||t.move(this.direction,this.apple),null===(e=this.snake)||void 0===e?void 0:e.checkCollision())return void this.onFail();this.setSnakeLength()}this.render(),setTimeout((()=>this.tick()),this.speed)}restart(t){var e,s;t.key===i.Space&&(document.removeEventListener("keyup",this.restart),null===(e=this.fail)||void 0===e||e.classList.remove("active"),null===(s=this.snake)||void 0===s||s.reset(),this.render(),this.initHandlers())}onFail(){var t;null===(t=this.fail)||void 0===t||t.classList.add("active"),document.addEventListener("keyup",this.restart)}initHandlers(){document.removeEventListener("keyup",this.keyboardHandler),document.addEventListener("keyup",this.startHandler)}startHandler(t){this.checkKeyboardEvent(t)&&(t.preventDefault(),t.stopPropagation(),this.direction=t.key,document.removeEventListener("keyup",this.startHandler),document.addEventListener("keyup",this.keyboardHandler),this.tick())}keyboardHandler(t){if(this.checkKeyboardEvent(t)){if(t.preventDefault(),t.stopPropagation(),r[t.key]===this.direction)return;this.direction=t.key}}render(){var t,e,s;null===(t=this.board)||void 0===t||t.render(),null===(e=this.apple)||void 0===e||e.render(),null===(s=this.snake)||void 0===s||s.render()}}})()})();