(()=>{"use strict";(()=>{const t=24,e=document.body.offsetWidth/3;class s{}s.size=e,s.step=e/t,s.ctx=(()=>{const t=document.createElement("canvas");t.width=e,t.height=e;const s=document.getElementById("root");return s&&s.appendChild(t),t.getContext("2d")})();const i=(t,e)=>Math.floor(Math.random()*(e-t)+t);var r,o;!function(t){t.Background="#333",t.Border="#000",t.Line="#444",t.Snake="#0f0",t.Apple="#f00"}(r||(r={})),function(t){t.ArrowUp="ArrowUp",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.Space=" "}(o||(o={}));const n={[o.ArrowUp]:o.ArrowDown,[o.ArrowLeft]:o.ArrowRight,[o.ArrowRight]:o.ArrowLeft,[o.ArrowDown]:o.ArrowUp,[o.Space]:o.Space},c=[{x:11,y:11}];class a{constructor(){this.coordinates=c}reset(){this.coordinates=c}get coords(){return this.coordinates}render(){s.ctx.fillStyle=r.Snake;for(const t of this.coordinates)s.ctx.fillRect(t.x*s.step,t.y*s.step,s.step,s.step)}move(e,s){const i=this.coordinates[this.coordinates.length-1],r=s.checkCollision(this.coordinates),n=r?this.coordinates:this.coordinates.slice(1);switch(r&&s.make(),e){case o.ArrowRight:this.coordinates=[...n,{x:i.x+1>=t?0:i.x+1,y:i.y}];break;case o.ArrowDown:this.coordinates=[...n,{x:i.x,y:i.y+1>=t?0:i.y+1}];break;case o.ArrowLeft:this.coordinates=[...n,{x:i.x?i.x-1:23,y:i.y}];break;case o.ArrowUp:default:this.coordinates=[...n,{x:i.x,y:i.y?i.y-1:23}]}}checkCollision(){const t=this.coordinates[this.coordinates.length-1];for(let e=0;e<this.coordinates.length-1;e++){const s=this.coordinates[e];if(t.x===s.x&&t.y===s.y)return!0}return!1}}class d{constructor(t){this.snake=t}checkCollision(t){var e;for(const s of t)if(s.x===(null===(e=this.coordinate)||void 0===e?void 0:e.x)&&s.y===this.coordinate.y)return!0;return!1}make(){let t;for(;!t;){const e={x:i(0,23),y:i(0,23)};for(const s of this.snake.coords)if(s.x!==e.x&&s.y!==e.y){t=e;break}}this.coordinate=t}render(){this.coordinate&&(s.ctx.fillStyle=r.Apple,s.ctx.fillRect(this.coordinate.x*s.step,this.coordinate.y*s.step,s.step,s.step))}}class h{render(){s.ctx.clearRect(0,0,s.size,s.size),s.ctx.fillStyle=r.Background,s.ctx.fillRect(0,0,s.size,s.size),s.ctx.beginPath(),s.ctx.strokeStyle=r.Line;for(let t=0;t<=s.size;t+=s.step)s.ctx.moveTo(t,0),s.ctx.lineTo(t,s.size),s.ctx.moveTo(0,t),s.ctx.lineTo(s.size,t);s.ctx.stroke(),s.ctx.strokeStyle=r.Border,s.ctx.strokeRect(0,0,s.size-1,s.size-1)}}new class{constructor(){this.size=document.body.offsetWidth/3,this.step=this.size/t,this.score=document.getElementById("score"),this.scoreCount=void 0,this.fail=document.getElementById("fail"),this.direction=o.ArrowUp,this.speed=500,this.startHandler=this.startHandler.bind(this),this.keyboardHandler=this.keyboardHandler.bind(this),this.restart=this.restart.bind(this),this.board=new h,this.snake=new a,this.apple=new d(this.snake),this.apple.make(),this.render(),this.initHandlers()}checkKeyboardEvent(t){return[o.ArrowUp,o.ArrowRight,o.ArrowDown,o.ArrowLeft].includes(t.key)}setSnakeLength(){var t,e;this.score&&this.scoreCount&&this.scoreCount!==(null===(t=this.snake)||void 0===t?void 0:t.coords.length)&&(this.speed=.95*this.speed,this.snake&&(this.scoreCount=null===(e=this.snake)||void 0===e?void 0:e.coords.length,this.score.innerHTML=this.scoreCount?`Длина змеи ${this.scoreCount}`:""))}tick(){var t,e;if(this.apple){if(null===(t=this.snake)||void 0===t||t.move(this.direction,this.apple),null===(e=this.snake)||void 0===e?void 0:e.checkCollision())return void this.onFail();this.setSnakeLength()}this.render(),setTimeout((()=>this.tick()),this.speed)}restart(t){var e,s;t.key===o.Space&&(document.removeEventListener("keyup",this.restart),null===(e=this.fail)||void 0===e||e.classList.remove("active"),null===(s=this.snake)||void 0===s||s.reset(),this.render(),this.initHandlers())}onFail(){var t;null===(t=this.fail)||void 0===t||t.classList.add("active"),document.addEventListener("keyup",this.restart)}initHandlers(){document.removeEventListener("keyup",this.keyboardHandler),document.addEventListener("keyup",this.startHandler)}startHandler(t){this.checkKeyboardEvent(t)&&(t.preventDefault(),t.stopPropagation(),this.direction=t.key,document.removeEventListener("keyup",this.startHandler),document.addEventListener("keyup",this.keyboardHandler),this.tick())}keyboardHandler(t){if(this.checkKeyboardEvent(t)){if(t.preventDefault(),t.stopPropagation(),n[t.key]===this.direction)return;this.direction=t.key}}render(){var t,e,s;null===(t=this.board)||void 0===t||t.render(),null===(e=this.apple)||void 0===e||e.render(),null===(s=this.snake)||void 0===s||s.render()}}})()})();